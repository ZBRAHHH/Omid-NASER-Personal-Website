<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Omid NASER</title>
  <link rel="icon" href="assets/img/favicon.ico" type="image/x-icon"/>
  <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body>
  <!-- Container pour le header -->
  <div id="header-container"></div>

  <main>
    <canvas id="pensine-canvas"></canvas>
  </main>

  <!-- Scripts CDN -->
  <script src="https://threejs.org/build/three.min.js"></script>
  <script src="https://threejs.org/examples/js/loaders/FontLoader.js"></script>
  <script src="https://threejs.org/examples/js/geometries/TextGeometry.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

  <!-- Scripts locaux -->
  <script src="assets/js/components.js"></script>

  <!-- Script intégré -->
  <script>
    window.onload = () => {
      const THREE = window.THREE;
      const FontLoader = window.FontLoader;
      const TextGeometry = window.TextGeometry;

      let scene, camera, renderer;
      let pensineParticles, risingParticles, glowSphere, textParticles;
      let textCycleTimer = 0;
      let textFadeIn = true;
      let textOpacity = 0;
      const pensineCount = 4000;
      const risingCount = 600;

      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.z = 120;

      renderer = new THREE.WebGLRenderer({
        canvas: document.getElementById('pensine-canvas'),
        alpha: true,
        antialias: true
      });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(window.devicePixelRatio);

      const geometry = new THREE.BufferGeometry();
      const positions = new Float32Array(pensineCount * 3);
      for (let i = 0; i < pensineCount; i++) {
        const theta = Math.random() * 2 * Math.PI;
        const phi = Math.acos(Math.random());
        const radius = 30 + Math.random() * 10;
        const x = radius * Math.sin(phi) * Math.cos(theta);
        const y = -radius * Math.cos(phi) * 0.8;
        const z = radius * Math.sin(phi) * Math.sin(theta);
        positions[i * 3] = x;
        positions[i * 3 + 1] = y;
        positions[i * 3 + 2] = z;
      }
      geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
      const material = new THREE.PointsMaterial({
        color: 0x66ccff,
        size: 1.2,
        transparent: true,
        opacity: 0.9,
        blending: THREE.AdditiveBlending,
        depthWrite: false
      });
      pensineParticles = new THREE.Points(geometry, material);
      scene.add(pensineParticles);

      const glowGeo = new THREE.SphereGeometry(40, 32, 32);
      const glowMat = new THREE.MeshBasicMaterial({
        color: 0x00ffff,
        transparent: true,
        opacity: 0.08,
        blending: THREE.AdditiveBlending,
        side: THREE.BackSide
      });
      glowSphere = new THREE.Mesh(glowGeo, glowMat);
      glowSphere.position.y = -10;
      scene.add(glowSphere);

      const riseGeo = new THREE.BufferGeometry();
      const risePos = new Float32Array(risingCount * 3);
      for (let i = 0; i < risingCount; i++) {
        risePos[i * 3] = (Math.random() - 0.5) * 10;
        risePos[i * 3 + 1] = 0;
        risePos[i * 3 + 2] = (Math.random() - 0.5) * 10;
      }
      riseGeo.setAttribute('position', new THREE.BufferAttribute(risePos, 3));
      const riseMat = new THREE.PointsMaterial({
        color: 0xffffff,
        size: 1,
        transparent: true,
        opacity: 0.7,
        blending: THREE.AdditiveBlending,
        depthWrite: false
      });
      risingParticles = new THREE.Points(riseGeo, riseMat);
      scene.add(risingParticles);

      const loader = new FontLoader();
      loader.load('https://threejs.org/examples/fonts/helvetiker_regular.typeface.json', function (font) {
        const textGeo = new TextGeometry('Omid Naser', {
          font: font,
          size: 8,
          height: 1,
        });
        textGeo.center();
        const textMat = new THREE.PointsMaterial({
          color: 0x00ffff,
          size: 1.5,
          transparent: true,
          opacity: 0,
          blending: THREE.AdditiveBlending
        });
        textParticles = new THREE.Points(textGeo, textMat);
        textParticles.position.y = 50;
        scene.add(textParticles);
      });

      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });

      window.addEventListener('click', () => {
        glowMat.opacity = 0.2;
        setTimeout(() => glowMat.opacity = 0.08, 300);
      });

      function animate() {
        requestAnimationFrame(animate);

        const pos = risingParticles.geometry.attributes.position;
        for (let i = 0; i < risingCount; i++) {
          pos.array[i * 3 + 1] += 0.2;
          if (pos.array[i * 3 + 1] > 80) pos.array[i * 3 + 1] = 0;
        }
        pos.needsUpdate = true;

        if (textParticles) {
          if (textFadeIn) {
            textOpacity += 0.01;
            if (textOpacity >= 0.9) {
              textOpacity = 0.9;
              textCycleTimer++;
              if (textCycleTimer > 100) textFadeIn = false;
            }
          } else {
            textOpacity -= 0.01;
            if (textOpacity <= 0) {
              textOpacity = 0;
              textCycleTimer++;
              if (textCycleTimer > 200) {
                textCycleTimer = 0;
                textFadeIn = true;
              }
            }
          }
          textParticles.material.opacity = textOpacity;
        }

        pensineParticles.rotation.y += 0.0015;
        pensineParticles.rotation.x = Math.sin(Date.now() * 0.0002) * 0.02;
        glowSphere.rotation.y += 0.0008;

        renderer.render(scene, camera);
      }

      animate();
    };

    // Protection & mode sombre
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('copy', e => e.preventDefault());
    document.getElementById('mode-toggle').onclick = () => {
      document.body.classList.toggle('dark-mode');
    };
  </script>
</body>
</html>
